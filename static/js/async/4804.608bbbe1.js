"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["4804"],{5353:function(e,n,i){i.r(n),i.d(n,{default:()=>o});var s=i(5893),t=i(65);function r(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",ol:"ol",li:"li",strong:"strong",h3:"h3",pre:"pre",h4:"h4",ul:"ul"},(0,t.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"async-events",children:["Async Events",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#async-events",children:"#"})]}),"\n",(0,s.jsxs)(n.h2,{id:"summary",children:["Summary",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#summary",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["In RNTL v14, all tests are async since ",(0,s.jsx)(n.code,{children:"render()"}),", ",(0,s.jsx)(n.code,{children:"fireEvent()"}),", and other core APIs return Promises. Beyond the basic async APIs, there are additional async utilities for handling events that complete over time:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Waiting for elements to appear"}),": Use ",(0,s.jsx)(n.code,{children:"findBy*"})," queries when elements appear after some delay (e.g., after data fetching)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Waiting for conditions"}),": Use ",(0,s.jsx)(n.code,{children:"waitFor()"})," to wait for arbitrary conditions to be met."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Waiting for elements to disappear"}),": Use ",(0,s.jsx)(n.code,{children:"waitForElementToBeRemoved()"})," when elements should be removed after some action."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These utilities help you write reliable tests that properly handle timing in your application."}),"\n",(0,s.jsxs)(n.h3,{id:"example",children:["Example",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#example",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"Consider a test for a user signing in with correct credentials:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"test('User can sign in with correct credentials', async () => {\n  // Typical test setup\n  const user = userEvent.setup();\n  await render(<App />);\n\n  // No need to use async here, components are already rendered\n  expect(screen.getByRole('header', { name: 'Sign in to Hello World App!' })).toBeOnTheScreen();\n\n  // Using await as User Event requires it\n  await user.type(screen.getByLabelText('Username'), 'admin');\n  await user.type(screen.getByLabelText('Password'), 'admin1');\n  await user.press(screen.getByRole('button', { name: 'Sign In' }));\n\n  // Using await as sign in operation is asynchronous\n  expect(await screen.findByRole('header', { name: 'Welcome admin!' })).toBeOnTheScreen();\n\n  // Follow-up assertions do not need to be async, as we already waited for sign in operation to complete\n  expect(\n    screen.queryByRole('header', { name: 'Sign in to Hello World App' })\n  ).not.toBeOnTheScreen();\n  expect(screen.queryByLabelText('Username')).not.toBeOnTheScreen();\n  expect(screen.queryByLabelText('Password')).not.toBeOnTheScreen();\n});\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"async-utilities",children:["Async utilities",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#async-utilities",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"There are several asynchronous utilities you might use in your tests."}),"\n",(0,s.jsxs)(n.h3,{id:"findby-queries",children:[(0,s.jsx)(n.code,{children:"findBy*"})," queries",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#findby-queries",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["The most common are the ",(0,s.jsxs)(n.a,{href:"/docs/api/queries#find-by",children:[(0,s.jsx)(n.code,{children:"findBy*"})," queries"]}),". These are useful when waiting for a matching element to appear. They can be understood as a ",(0,s.jsxs)(n.a,{href:"/docs/api/queries#get-by",children:[(0,s.jsx)(n.code,{children:"getBy*"})," queries"]})," used in conjunction with a ",(0,s.jsxs)(n.a,{href:"/docs/api/misc/async#waitfor",children:[(0,s.jsx)(n.code,{children:"waitFor"})," function"]}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["They accept the same predicates as ",(0,s.jsx)(n.code,{children:"getBy*"})," queries like ",(0,s.jsx)(n.code,{children:"findByRole"}),", ",(0,s.jsx)(n.code,{children:"findByTest"}),", etc. They also have a multiple elements variant called ",(0,s.jsx)(n.a,{href:"/docs/api/queries#find-all-by",children:(0,s.jsx)(n.code,{children:"findAllBy*"})}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function findByRole: (\n  role: TextMatch,\n  queryOptions?: {\n    // Query specific options\n  }\n  waitForOptions?: {\n    timeout?: number;\n    interval?: number;\n    // ..\n  }\n): Promise<HostElement>;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each query has a default ",(0,s.jsx)(n.code,{children:"timeout"})," value of 1000 ms and a default ",(0,s.jsx)(n.code,{children:"interval"})," of 50 ms. Custom timeout and check intervals can be specified if needed, as shown below:"]}),"\n",(0,s.jsxs)(n.h4,{id:"example-1",children:["Example",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#example-1",children:"#"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const button = await screen.findByRole(\n  'button',\n  { name: 'Start' },\n  { timeout: 1000, interval: 50 }\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Alternatively, a default global ",(0,s.jsx)(n.code,{children:"timeout"})," value can be set using the ",(0,s.jsxs)(n.a,{href:"/docs/api/misc/config#configure",children:[(0,s.jsx)(n.code,{children:"configure"})," function"]}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"configure({ asyncUtilTimeout: timeout });\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"waitfor-function",children:[(0,s.jsx)(n.code,{children:"waitFor"})," function",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#waitfor-function",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"waitFor"})," function is another option, serving as a lower-level utility in more advanced cases."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function waitFor<T>(\n  expectation: () => T,\n  options?: {\n    timeout: number;\n    interval: number;\n  }\n): Promise<T>;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["It accepts an ",(0,s.jsx)(n.code,{children:"expectation"})," to be validated and repeats the check every defined interval until it no longer throws an error. Similarly to ",(0,s.jsx)(n.code,{children:"findBy*"})," queries they accept ",(0,s.jsx)(n.code,{children:"timeout"})," and ",(0,s.jsx)(n.code,{children:"interval"})," options and have the same default values of 1000ms for timeout, and a checking interval of 50 ms."]}),"\n",(0,s.jsxs)(n.h4,{id:"example-2",children:["Example",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#example-2",children:"#"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"await waitFor(() => expect(mockAPI).toHaveBeenCalledTimes(1));\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If you want to use it with ",(0,s.jsx)(n.code,{children:"getBy*"})," queries, use the ",(0,s.jsx)(n.code,{children:"findBy*"})," queries instead, as they essentially do the same, but offer better developer experience."]}),"\n",(0,s.jsxs)(n.h3,{id:"waitforelementtoberemoved-function",children:[(0,s.jsx)(n.code,{children:"waitForElementToBeRemoved"})," function",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#waitforelementtoberemoved-function",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["A specialized function, ",(0,s.jsx)(n.a,{href:"/docs/api/misc/async#waitforelementtoberemoved",children:(0,s.jsx)(n.code,{children:"waitForElementToBeRemoved"})}),", is used to verify that a matching element was present but has since been removed."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function waitForElementToBeRemoved<T>(\n  expectation: () => T,\n  options?: {\n    timeout: number;\n    interval: number;\n  }\n): Promise<T> {}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This function is, in a way, the negation of ",(0,s.jsx)(n.code,{children:"waitFor"})," as it expects the initial expectation to be true (not throw an error), only to turn invalid (start throwing errors) on subsequent runs. It operates using the same ",(0,s.jsx)(n.code,{children:"timeout"})," and ",(0,s.jsx)(n.code,{children:"interval"})," parameters as ",(0,s.jsx)(n.code,{children:"findBy*"})," queries and ",(0,s.jsx)(n.code,{children:"waitFor"}),"."]}),"\n",(0,s.jsxs)(n.h4,{id:"example-3",children:["Example",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#example-3",children:"#"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"await waitForElementToBeRemoved(() => getByText('Hello World'));\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"fake-timers",children:["Fake Timers",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#fake-timers",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["Asynchronous tests can take long to execute due to the delays introduced by asynchronous operations. To mitigate this, fake timers can be used. These are particularly useful when delays are mere waits, such as the 130 milliseconds wait introduced by the UserEvent ",(0,s.jsx)(n.code,{children:"press()"})," event due to React Native runtime behavior or simulated 1000 wait in a API call mock. Fake timers allow for precise fast-forwarding through these wait periods."]}),"\n",(0,s.jsxs)(n.p,{children:["Here are the basics of using ",(0,s.jsx)(n.a,{href:"https://jestjs.io/docs/timer-mocks",target:"_blank",rel:"noopener noreferrer",children:"Jest fake timers"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Enable fake timers with: ",(0,s.jsx)(n.code,{children:"jest.useFakeTimers()"})]}),"\n",(0,s.jsxs)(n.li,{children:["Disable fake timers with: ",(0,s.jsx)(n.code,{children:"jest.useRealTimers()"})]}),"\n",(0,s.jsxs)(n.li,{children:["Advance fake timers forward with: ",(0,s.jsx)(n.code,{children:"jest.advanceTimersByTime(interval)"})]}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.strong,{children:"all timers"})," to completion with: ",(0,s.jsx)(n.code,{children:"jest.runAllTimers()"})]}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.strong,{children:"currently pending timers"})," to completion with: ",(0,s.jsx)(n.code,{children:"jest.runOnlyPendingTimers()"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Be cautious when running all timers to completion as it might create an infinite loop if these timers schedule follow-up timers. In such cases, it's safer to use ",(0,s.jsx)(n.code,{children:"jest.runOnlyPendingTimers()"})," to avoid ending up in an infinite loop of scheduled tasks."]}),"\n",(0,s.jsxs)(n.p,{children:["You can use both built-in Jest fake timers, as well as ",(0,s.jsx)(n.a,{href:"https://sinonjs.org/releases/latest/fake-timers/",target:"_blank",rel:"noopener noreferrer",children:"Sinon.JS fake timers"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Note: you do not need to advance timers by hand when using User Event API, as it's automatically."})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(r,{...e})}):r(e)}let o=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["14.x%2Fcookbook%2Fbasics%2Fasync-events.md"]={toc:[{text:"Summary",id:"summary",depth:2},{text:"Example",id:"example",depth:3},{text:"Async utilities",id:"async-utilities",depth:2},{text:"`findBy*` queries",id:"findby-queries",depth:3},{text:"Example",id:"example-1",depth:4},{text:"`waitFor` function",id:"waitfor-function",depth:3},{text:"Example",id:"example-2",depth:4},{text:"`waitForElementToBeRemoved` function",id:"waitforelementtoberemoved-function",depth:3},{text:"Example",id:"example-3",depth:4},{text:"Fake Timers",id:"fake-timers",depth:2}],title:"Async Events",headingTitle:"Async Events",frontmatter:{}}}}]);