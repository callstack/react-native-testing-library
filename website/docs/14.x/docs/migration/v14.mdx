# Migration to 14.x

This guide describes the migration to React Native Testing Library version 14 from version 13.x.

## Breaking changes

### `fireEvent` is now async by default

In v14, `fireEvent` and its helpers (`press`, `changeText`, `scroll`) are now async by default and return a Promise. This change makes it compatible with React 19, React Suspense, and `React.use()`.

**Before (v13):**

```ts
import { fireEvent, screen } from '@testing-library/react-native';

it('should press button', () => {
  render(<MyComponent />);
  fireEvent.press(screen.getByText('Press me'));
  expect(onPress).toHaveBeenCalled();
});
```

**After (v14):**

```ts
import { fireEvent, screen } from '@testing-library/react-native';

it('should press button', async () => {
  render(<MyComponent />);
  await fireEvent.press(screen.getByText('Press me'));
  expect(onPress).toHaveBeenCalled();
});
```

### Migration path

To ease migration, we provide `unsafe_fireEventSync` which maintains the same synchronous behavior as v13. This allows you to migrate gradually.

#### `unsafe_fireEventSync` {#unsafe-fire-event-sync}

```ts
function unsafe_fireEventSync(
  element: ReactTestInstance,
  eventName: string,
  ...data: unknown[]
): void;
```

**⚠️ Deprecated**: This function is provided for migration purposes only. Use async `fireEvent` instead.

The synchronous version of `fireEvent` that returns immediately without awaiting React updates. This maintains backward compatibility with v13 tests but is not recommended for new code.

```ts
// Old v13 code (still works but deprecated)
import { unsafe_fireEventSync } from '@testing-library/react-native';

it('should press button', () => {
  render(<MyComponent />);
  unsafe_fireEventSync.press(screen.getByText('Press me'));
  expect(onPress).toHaveBeenCalled();
});
```

### `render` is now async by default {#render-async-default}

In v14, `render` is now async by default and returns a Promise. The previous synchronous `render` function has been renamed to `unsafe_renderSync`. This change makes it compatible with React 19, React Suspense, and `React.use()`.

**Before (v13):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should render component', () => {
  render(<MyComponent />);
  expect(screen.getByText('Hello')).toBeOnTheScreen();
});
```

**After (v14):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should render component', async () => {
  await render(<MyComponent />);
  expect(screen.getByText('Hello')).toBeOnTheScreen();
});
```

### Migration path

To ease migration, we provide `unsafe_renderSync` which maintains the same synchronous behavior as v13. This allows you to migrate gradually.

#### `unsafe_renderSync` {#unsafe-render-sync}

```ts
function unsafe_renderSync(
  component: React.Element<any>,
  options?: RenderSyncOptions
): RenderSyncResult;
```

**⚠️ Deprecated**: This function is provided for migration purposes only. Use async `render` instead.

The synchronous version of `render` that returns immediately without awaiting React updates. This maintains backward compatibility with v13 tests but is not recommended for new code.

```ts
// Old v13 code (still works but deprecated)
import { unsafe_renderSync } from '@testing-library/react-native';

it('should render component', () => {
  unsafe_renderSync(<MyComponent />);
  expect(screen.getByText('Hello')).toBeOnTheScreen();
});
```

### Step-by-step migration guide

To migrate from `unsafe_renderSync` to `render`:

### 1. Add `async` to your test function

```ts
// Before
it('should render component', () => {

// After
it('should render component', async () => {
```

### 2. Await `render`

```ts
// Before
render(<MyComponent />);

// After
await render(<MyComponent />);
```

### 3. Update `rerender` calls to use `rerenderAsync` and await

```ts
// Before
screen.rerender(<MyComponent />);

// After
await screen.rerenderAsync(<MyComponent />);
```

### 4. Update `unmount` calls to use `unmountAsync` and await

```ts
// Before
screen.unmount();

// After
await screen.unmountAsync();
```

### Complete example

**Before (v13):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should update component', () => {
  render(<Counter initialCount={0} />);
  expect(screen.getByText('Count: 0')).toBeOnTheScreen();

  screen.rerender(<Counter initialCount={5} />);
  expect(screen.getByText('Count: 5')).toBeOnTheScreen();

  screen.unmount();
});
```

**After (v14):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should update component', async () => {
  await render(<Counter initialCount={0} />);
  expect(screen.getByText('Count: 0')).toBeOnTheScreen();

  await screen.rerenderAsync(<Counter initialCount={5} />);
  expect(screen.getByText('Count: 5')).toBeOnTheScreen();

  await screen.unmountAsync();
});
```

## Benefits of async `render`

- **React 19 compatibility**: Works seamlessly with React 19's async features
- **Suspense support**: Properly handles React Suspense boundaries and `React.use()`
- **Better timing**: Ensures all pending React updates are executed before assertions
- **Future-proof**: Aligns with React's direction toward async rendering

For more details, see the [`render` API documentation](/docs/api/render).

### `renderHook` is now async by default

In v14, `renderHook` is now async by default and returns a Promise. This change makes it compatible with React 19, React Suspense, and `React.use()`.

**Before (v13):**

```ts
import { renderHook } from '@testing-library/react-native';

it('should test hook', () => {
  const { result, rerender } = renderHook(() => useMyHook());

  rerender(newProps);
  unmount();
});
```

**After (v14):**

```ts
import { renderHook } from '@testing-library/react-native';

it('should test hook', async () => {
  const { result, rerender } = await renderHook(() => useMyHook());

  await rerender(newProps);
  await unmount();
});
```

### Migration path

To ease migration, we provide `unsafe_renderHookSync` which maintains the same synchronous behavior as v13. This allows you to migrate gradually.

#### `unsafe_renderHookSync` {#unsafe-render-hook-sync}

```ts
function unsafe_renderHookSync<Result, Props>(
  hookFn: (props?: Props) => Result,
  options?: RenderHookOptions<Props>
): RenderHookSyncResult<Result, Props>;
```

**⚠️ Deprecated**: This function is provided for migration purposes only. Use async `renderHook` instead.

The synchronous version of `renderHook` that returns immediately without awaiting React updates. This maintains backward compatibility with v13 tests but is not recommended for new code.

```ts
// Old v13 code (still works but deprecated)
import { unsafe_renderHookSync } from '@testing-library/react-native';

it('should increment count', () => {
  const { result, rerender } = unsafe_renderHookSync(() => useCount());

  expect(result.current.count).toBe(0);
  act(() => {
    result.current.increment();
  });
  expect(result.current.count).toBe(1);

  rerender();
});
```

#### Result types

**v13 (deprecated):**

```ts
interface RenderHookSyncResult<Result, Props> {
  result: { current: Result };
  rerender: (props: Props) => void;
  unmount: () => void;
}
```

**v14 (default):**

```ts
interface RenderHookResult<Result, Props> {
  result: { current: Result };
  rerender: (props: Props) => Promise<void>;
  unmount: () => Promise<void>;
}
```

**Note**: Both `RenderHookSyncResult` and `RenderHookResult` use `rerender` and `unmount` methods. The difference is that `RenderHookSyncResult` methods are synchronous (return `void`), while `RenderHookResult` methods are async (return `Promise<void>`).

## Step-by-step migration guide

To migrate from `unsafe_renderHookSync` to `renderHook`:

### 1. Add `async` to your test function

```ts
// Before
it('should test hook', () => {

// After
it('should test hook', async () => {
```

### 2. Await `renderHook`

```ts
// Before
const { result } = unsafe_renderHookSync(() => useMyHook());

// After
const { result } = await renderHook(() => useMyHook());
```

### 3. Update `rerender` calls to await

```ts
// Before
rerender(newProps);

// After
await rerender(newProps);
```

### 4. Update `unmount` calls to await

```ts
// Before
unmount();

// After
await unmount();
```

### 5. Update `act` calls to use async `act`

```ts
// Before
act(() => {
  result.current.doSomething();
});

// After
await act(async () => {
  result.current.doSomething();
});
```

## Complete example

**Before (v13):**

```ts
import { renderHook, act } from '@testing-library/react-native';

it('should increment count', () => {
  const { result, rerender } = renderHook((initialCount: number) => useCount(initialCount), {
    initialProps: 1,
  });

  expect(result.current.count).toBe(1);

  act(() => {
    result.current.increment();
  });

  expect(result.current.count).toBe(2);
  rerender(5);
  expect(result.current.count).toBe(5);
});
```

**After (v14):**

```ts
import { renderHook, act } from '@testing-library/react-native';

it('should increment count', async () => {
  const { result, rerender } = await renderHook((initialCount: number) => useCount(initialCount), {
    initialProps: 1,
  });

  expect(result.current.count).toBe(1);

  await act(async () => {
    result.current.increment();
  });

  expect(result.current.count).toBe(2);
  await rerender(5);
  expect(result.current.count).toBe(5);
});
```

## Benefits of async `renderHook`

- **React 19 compatibility**: Works seamlessly with React 19's async features
- **Suspense support**: Properly handles React Suspense boundaries and `React.use()`
- **Better timing**: Ensures all pending React updates are executed before assertions
- **Future-proof**: Aligns with React's direction toward async rendering

For more details, see the [`renderHook` API documentation](/docs/api/misc/render-hook).
