# Migration to 14.x

This guide describes the migration to React Native Testing Library version 14 from version 13.x.

## Overview

RNTL v14 is a major release that **drops support for React 18** and fully embraces React 19's async-first paradigm. Key changes include:

- **React 19+ required**: Minimum supported versions are React 19.0.0 and React Native 0.78+
- **Async APIs by default**: `render`, `renderHook`, `fireEvent`, and `act` are now async
- **New rendering engine**: Switched from deprecated `react-test-renderer` to [`test-renderer`](https://github.com/mdjastrzebski/test-renderer)
- **API cleanup**: Removed deprecated APIs (`update`, `getQueriesForElement`, `UNSAFE_root`)
- **Safe `container` API**: Reintroduced `container` which is now safe to use

:::info React 18 Users

If you need to support React 18, please continue using RNTL v13.x.

:::

## Quick Migration

We provide codemods to automate most of the migration:

```bash
# Step 1: Update dependencies
npx codemod@latest rntl-v14-update-deps --target .
npm install  # or yarn/pnpm

# Step 2: Update test code to async
npx codemod@latest rntl-v14-async-functions --target ./src
```

After running the codemods, review the changes and run your tests.

## Breaking Changes

### Supported React and React Native versions

**This version requires React 19+ and React Native 0.78+.** If you need to support React 18, please use the latest v13.x version.

| RNTL Version | React Version | React Native Version |
|--------------|---------------|---------------------|
| v14.x        | >= 19.0.0     | >= 0.78             |
| v13.x        | >= 18.0.0     | >= 0.71             |

### Test Renderer replaces React Test Renderer

In v14, React Native Testing Library now uses [Test Renderer](https://github.com/mdjastrzebski/test-renderer) instead of the deprecated `react-test-renderer` package. Test Renderer is a modern, actively maintained alternative that provides better compatibility with React 19 and improved type safety.

**What changed:**

- The underlying rendering engine has been switched from `react-test-renderer` to `test-renderer`
- This change is mostly internal and should not require code changes in most cases
- Type definitions have been updated to use `HostElement` from Test Renderer instead of `ReactTestInstance`

**Migration:**

#### 1. Update dependencies

Run codemod for updating dependencies:

```bash
npx codemod@latest rntl-v14-update-deps
npm install
```

##### Manual changes

Remove `react-test-renderer` and its type definitions from your dev dependencies, and add `test-renderer`:

```bash
# Using npm
npm uninstall react-test-renderer @types/react-test-renderer
npm install -D test-renderer@^0.14.0
```

#### 2. Update type imports (if needed)

If you were directly importing types from `react-test-renderer`, you may need to update your imports:

```ts
// Before (v13)
import type { ReactTestInstance } from 'react-test-renderer';

// After (v14)
import type { HostElement } from 'test-renderer';
```

**Note:** Most users won't need to update type imports, as React Native Testing Library now exports the necessary types directly.

For more details, see the [Test Renderer documentation](https://github.com/mdjastrzebski/test-renderer).

### Async APIs by Default

With React 18 support dropped, RNTL v14 fully embraces React 19's async rendering model. The following functions are now async by default:

- `render()` → returns `Promise<RenderResult>`
- `rerender()` and `unmount()` → return `Promise<void>`
- `renderHook()` → returns `Promise<RenderHookResult>`
- `fireEvent()` and helpers (`press`, `changeText`, `scroll`) → return `Promise<void>`
- `act()` → always returns `Promise<T>`

#### `render` is now async {#render-async-default}

In v14, `render` is now async by default and returns a Promise. This change leverages React 19's async rendering model, enabling proper support for React Suspense and `React.use()`.

**Before (v13):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should render component', () => {
  render(<MyComponent />);
  expect(screen.getByText('Hello')).toBeOnTheScreen();
});
```

**After (v14):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should render component', async () => {
  await render(<MyComponent />);
  expect(screen.getByText('Hello')).toBeOnTheScreen();
});
```

##### Step-by-step migration

To migrate from v13 `render` to v14 `render`:

**1. Add `async` to your test function**

```ts
// Before (v13)
it('should render component', () => {

// After (v14)
it('should render component', async () => {
```

**2. Await `render`**

```ts
// Before
render(<MyComponent />);

// After
await render(<MyComponent />);
```

**3. Update `rerender` calls to await**

```ts
// Before
screen.rerender(<MyComponent />);

// After
await screen.rerender(<MyComponent />);
```

**4. Update `unmount` calls to await**

```ts
// Before
screen.unmount();

// After
await screen.unmount();
```

##### Complete example

**Before (v13):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should update component', () => {
  render(<Counter initialCount={0} />);
  expect(screen.getByText('Count: 0')).toBeOnTheScreen();

  screen.rerender(<Counter initialCount={5} />);
  expect(screen.getByText('Count: 5')).toBeOnTheScreen();

  screen.unmount();
});
```

**After (v14):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should update component', async () => {
  await render(<Counter initialCount={0} />);
  expect(screen.getByText('Count: 0')).toBeOnTheScreen();

  await screen.rerender(<Counter initialCount={5} />);
  expect(screen.getByText('Count: 5')).toBeOnTheScreen();

  await screen.unmount();
});
```

For more details, see the [`render` API documentation](/docs/api/render).

#### `renderHook` is now async

In v14, `renderHook` is now async by default and returns a Promise. This change leverages React 19's async rendering model.

**Before (v13):**

```ts
import { renderHook } from '@testing-library/react-native';

it('should test hook', () => {
  const { result, rerender } = renderHook(() => useMyHook());

  rerender(newProps);
  unmount();
});
```

**After (v14):**

```ts
import { renderHook } from '@testing-library/react-native';

it('should test hook', async () => {
  const { result, rerender } = await renderHook(() => useMyHook());

  await rerender(newProps);
  await unmount();
});
```

##### Complete example

**Before (v13):**

```ts
import { renderHook, act } from '@testing-library/react-native';

it('should increment count', () => {
  const { result, rerender } = renderHook((initialCount: number) => useCount(initialCount), {
    initialProps: 1,
  });

  expect(result.current.count).toBe(1);

  act(() => {
    result.current.increment();
  });

  expect(result.current.count).toBe(2);
  rerender(5);
  expect(result.current.count).toBe(5);
});
```

**After (v14):**

```ts
import { renderHook, act } from '@testing-library/react-native';

it('should increment count', async () => {
  const { result, rerender } = await renderHook((initialCount: number) => useCount(initialCount), {
    initialProps: 1,
  });

  expect(result.current.count).toBe(1);

  await act(async () => {
    result.current.increment();
  });

  expect(result.current.count).toBe(2);
  await rerender(5);
  expect(result.current.count).toBe(5);
});
```

For more details, see the [`renderHook` API documentation](/docs/api/misc/render-hook).

#### `fireEvent` is now async

In v14, `fireEvent` and its helpers (`press`, `changeText`, `scroll`) are now async by default and return a Promise.

**Before (v13):**

```ts
import { fireEvent, screen } from '@testing-library/react-native';

it('should press button', () => {
  render(<MyComponent />);
  fireEvent.press(screen.getByText('Press me'));
  expect(onPress).toHaveBeenCalled();
});
```

**After (v14):**

```ts
import { fireEvent, screen } from '@testing-library/react-native';

it('should press button', async () => {
  await render(<MyComponent />);
  await fireEvent.press(screen.getByText('Press me'));
  expect(onPress).toHaveBeenCalled();
});
```

#### `act` is now async

In v14, `act` is now async by default and always returns a Promise.

**What changed:**

- `act` now always returns a `Promise<T>` instead of `T | Thenable<T>`
- The API is more consistent and predictable

**Before (v13):**

```ts
import { act } from '@testing-library/react-native';

it('should update state', () => {
  act(() => {
    setState('new value');
  });
  expect(state).toBe('new value');
});
```

**After (v14):**

```ts
import { act } from '@testing-library/react-native';

it('should update state', async () => {
  await act(async () => {
    setState('new value');
  });
  expect(state).toBe('new value');
});
```

**Note**: Even if your callback is synchronous, you should still use `await act(async () => ...)` as `act` now always returns a Promise.

For more details, see the [`act` API documentation](/docs/api/misc/other#act).

#### Benefits of Async APIs

- **Suspense support**: Properly handles React Suspense boundaries and `React.use()`
- **Better timing**: Ensures all pending React updates are executed before assertions
- **Simpler mental model**: All rendering operations are consistently async
- **Future-proof**: Aligns with React's direction toward async rendering

### Removed APIs

#### `update` alias removed

The `update` alias for `rerender` has been removed. Use `rerender` instead:

```ts
// Before (v13)
screen.update(<MyComponent />);
const { update } = render(<MyComponent />);
update(<MyComponent newProp />);

// After (v14)
await screen.rerender(<MyComponent />);
const { rerender } = await render(<MyComponent />);
await rerender(<MyComponent newProp />);
```

#### `getQueriesForElement` export removed

The `getQueriesForElement` export alias for `within` has been removed. Use `within` instead:

```ts
// Before (v13)
import { getQueriesForElement } from '@testing-library/react-native';

const queries = getQueriesForElement(element);

// After (v14)
import { within } from '@testing-library/react-native';

const queries = within(element);
```

**Note:** `getQueriesForElement` was just an alias for `within`, so the functionality is identical - only the import needs to change.

#### `UNSAFE_root` removed

`UNSAFE_root` has been removed. Use `container` to access the pseudo-element container, or `root` to access the first rendered host element:

```ts
// Before (v13)
const unsafeRoot = screen.UNSAFE_root;

// After (v14)
const container = screen.container; // pseudo-element container
const root = screen.root;           // first rendered host element
```

### `container` API reintroduced

In v14, the `container` API has been reintroduced and is now safe to use. Previously, `container` was renamed to `UNSAFE_root` in v12 due to behavioral differences from React Testing Library's `container`. In v14, `container` now returns a pseudo-element container whose children are the elements you asked to render, making it safe and consistent with React Testing Library's behavior.

**What changed:**

- `screen.container` is now available and safe to use
- `container` returns a pseudo-element container from Test Renderer
- The container's children are the elements you rendered
- `UNSAFE_root` has been removed

**Before (v13):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should access root', () => {
  render(<MyComponent />);
  // UNSAFE_root was the only way to access the container
  const root = screen.UNSAFE_root;
});
```

**After (v14):**

```ts
import { render, screen } from '@testing-library/react-native';

it('should access container', async () => {
  await render(<MyComponent />);
  // container is now safe and available
  const container = screen.container;
  // root is the first child of container
  const root = screen.root;
});
```

For more details, see the [`screen` API documentation](/docs/api/screen#container).

### Text string validation enforced by default

In v14, Test Renderer automatically enforces React Native's requirement that text strings must be rendered within a `<Text>` component. This means the `unstable_validateStringsRenderedWithinText` option has been removed from `RenderOptions`, as this validation is now always enabled.

**What changed:**

- Text string validation is now always enabled and cannot be disabled
- The `unstable_validateStringsRenderedWithinText` option has been removed
- Tests will now throw `Invariant Violation: Text strings must be rendered within a <Text> component` errors when attempting to render strings outside of `<Text>` components, matching React Native's runtime behavior

**Migration:**

If you were using `unstable_validateStringsRenderedWithinText: true` in your render options, you can simply remove this option as the validation is now always enabled:

```ts
// Before (v13)
await render(<MyComponent />, {
  unstable_validateStringsRenderedWithinText: true,
});

// After (v14)
await render(<MyComponent />);
// Validation is now always enabled
```

If you were relying on the previous behavior where strings could be rendered outside of `<Text>` components, you'll need to fix your components to wrap strings in `<Text>` components, as this matches React Native's actual runtime behavior.

## Codemods

We provide two codemods to automate the migration:

### `rntl-v14-update-deps`

Updates your `package.json`:
- Removes `react-test-renderer` and `@types/react-test-renderer`
- Adds `test-renderer`
- Updates `@testing-library/react-native` to `^14.0.0`

```bash
npx codemod@latest rntl-v14-update-deps --target .
npm install
```

### `rntl-v14-async-functions`

Transforms test files:
- Adds `await` to `render()`, `act()`, `renderHook()`, `fireEvent()` calls
- Makes test functions async when needed
- Handles `screen.rerender()`, `screen.unmount()`, and renderer methods

```bash
npx codemod@latest rntl-v14-async-functions --target ./src
```

#### Custom render functions

If you have custom render helpers (like `renderWithProviders`), specify them:

```bash
npx codemod@latest rntl-v14-async-functions --target ./src --param customRenderFunctions="renderWithProviders,renderWithTheme"
```

#### Limitations

- Helper functions defined in test files are not transformed by default
- Namespace imports (`import * as RNTL`) are not handled

## Full Changelog

https://github.com/callstack/react-native-testing-library/compare/v13.x.x...v14.0.0
